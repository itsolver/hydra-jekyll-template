language: ruby
rvm:
- 2.4.1
dist: trusty
sudo: required
branches:
  only:
  - master
cache:
  bundler: true
  directories:
  - node_modules
env:
  global:
  - NOKOGIRI_USE_SYSTEM_LIBRARIES=true
  # Firebase API Token
  - secure: "RmLxkrozaETvGJRc8jNL4odd0eqnSa2GNuGllHxgRnAmew05ABJHAC3OERh/lr7TpHYNDoICziOVSVN+FiLCiw7OTqDcP/+e4LhtGxDOZ16SCzz5YUnOx1Qyc1eJhQxwAqgs/3zkqnK1epI9a+qLZhoCya7BjK7RJgCPuPjGlty6O6Cym+UEMWMtpv908vfj0BNsb/eCKxUqtz4rDOA98NCiprGeFBGFqLx4fuYYODobQdsXGpGMSoo3zJWqW6JMqSn8PQwTPeFj9RToLZtrbQADxDfShV6R8oPhPQCeqwmZy6lud9vZbkQVPPrLmJZLq4ovle+m1z2VED8IHXfKH66YdnH5w7JSas4u3fJPbSySAZi5maHauQ8sRwEa8B9PczJjn8EtNd/4OEnWIyv/Js9/eklW6q2mdn4UpM9TLYVazLW5DMg07ZLwYtzOTqt9T0wHGN7oYdIqHA0YUXpGFqS6h/61dE28OXy9sRT/YP4QyjEuo5JTY4kcGVNVDypouMyZL2zwZQ5HNS3LJF6Hq+QTnQbgtoAuTNySnJDZ1p/a101hZPLrqHKmck97DQnKm+8xeFo1IbNrUqdiafD5wTMfEsrD+THDKBLNJWFACKf7Weh0RQAmYk0Yj1e7jqYGFonfuVcE7mUla9elRfmJ478q7jaLnqG+zzgZIGCgjZ4="
  # Stripe Test keys
  #- secure: "XvzAlFV1WN+jTrLYKGiUe3gVX7tS2rWNodiDdLppT3KKzQTHoGzHc3aP7AXdgSDF/ZTetACzxW6UJZ+Amgdn7QcMOF+RWugytk5frMCy49df9IaBqsZm5Z6vkk9CtgLg9lbO6IMJVDFuRuKSr2TLPeNYovS2j9W1Vrpg6kExsTvynOTBuLLzXPNyC8Rv/fyxCw8UJ/WUZSuPL1iYE5uVRWa1pdHW+45N05dr7mWbZplK87fGwu7+2QUxzaD3dcfRGAwDt3MQe/fK4t6smOgbxsfgF9H6mlD5tOj0vjtVLnqA72o7hr7/6PvGKi/C1bf4wTJbfMMbaJMOt/ehPjH6mOGgBgesNTFhODvf4xyGvXdk3xeh8DkkpEADdRyXifsu8i+xJW2VZ0BGAck2D9hxaPacde2v5nUlt/fQ0icBm+B2DiPtQj1y+CgF12Mr5ezNxN/Ik08YYQ8Azbyke2XPALIBlCronantYDI2cTiovMtTNhW/cci13p0EHpIT1FNXFSvXC3EzlYUa2AXlVLbecUCYjOy3MlutdN/ABqIVyvBnN2+wAo1Y4jVPxjljDzzTl6kOAbmxJuiF9+KwIisUQgVaulxUc0SthJ+BISDoibvGwX8pco+65nEqhIbvRSUCPwk1gW/sn3QambCTEabO4TIleryvqkCtyKMp9vTjlGg="
  #- secure: "sH9b0yTwHDcBKzwyFLUo9kIV2+zts8SUnlv08Z43nzp7RRiDZXUIxJ13uIsag56y+K66QpkjUWJB80QlUj50N6q0Zptue9OMWzFvphBfW0BGRY/e/rePKmNqFekoilCGFNKtc//hVUrykgb539rbMPnGLKt6yGb9rHlxHsJa2+XxrMKpPbiZvfRsD3FVfMeWeLDLnPEw17Kz/kqoVpL0XHdf/Tm1V9MQME69YufwidsmYY1IEOPO1chQj9D3GzS6hl/YqjvN5C2TuANAQgN97fBcoeY5mlR0I0V4r2MillsW1XoYsLCqEjtCTHPTMh5lvyhce8hYghKBegtWSsMy/SImQ7sMk1D9RUtsvc5G18/ZYMXFrZcUL7fPpfGK/u5blMP0j294q7JLGOcsSmAeJq00LnTy5fRW5F6nGFIq3YqU3ymUyDp87lY4gVdzXbh4X4apl8Zcf9KpTUb0+DttTtg/XlNaU0ONSqCS1iY3XTcKgYcF+fqW2GqBB8X1RQEPaGrHemLZqqrUC3v7XkmDXTx958ADw5xgEmClJhkq49z3pMynBZxF6ArRDrGITENzp2RqkG0BIpsNX8sax0dGJV7eqy+sB7J7U7mrOJFV8+chAC56cvuomACkMN8RlNhiFFkRJcaBH55O/NLKarZ9GVnxiCsA4uB1FNEkCUUND4E="
  #- secure: "IROERna7eyv2eDRlFcQfEq00H4eVrx42whdvO/reTF2JyWBG19mCGZpdUWIP5WJx47AX8lHNh00RC9pqsfTM5d8AJ043GGRog1WEv8iIoSOvZHgwudfsIwMa172NkH3hAt/A2u8GzgbPLhYy61z4+SnsMQOMsYZ2lMY4yB4IVWM8nZuCP3PVZ90x8kRcPR4lJaiXdRd5Mknfme65mQFOjq8M9DaP/nnp0iZsEOJC+LZ8QviDRuDgJ52QST6FAMl+5zSRS5mms17YLa+8IFpQmmqlWSIViWy50Jz6VxTp7P5PAsklaJr/eB7IaHQHiOAfifM5OFtuSE8AFIhxn+7ayI2xXqgD6QbtE22fz/dGNbLZ/mvjwhHL58aeuhu0+rfn5leBUBBQFSNJqictZXtQ2mJBZ3HCNM7Eb9Ve2YDg8fvROKqaOioTMmpkpN700BLLC6fkyE73+gvuvBL1nksrcpR6Asp8LM3yqksdHq4mJE52up2IR5JKScO/NpuAWfaq6+b5GbjJcUriCCOHTYPb8hCgJFEMUIK0/ALrQA7p2LfHs0YhEDNTAuUTv+rG7Llblnw6LzZ2x9dPL8K6j6QCqiBrWvYAvzQKFHAPJSgg4mP2qY9q7AwkGWI9SDiEFCeTVIeVU5Qi/LMuoXRFSmBIQGNlsdlQm00IQzhNKi++z7o="
  # Stripe Live keys
  - secure: "PE/16+MsCeExydfYdUvfdeLTxoOrpSoHCV8KFWSaMuZnuk71hFLVJlzUaNJa0mL2jZTCpyx+bmlCWPWkAVgh9EqCOxlyNVDoUodgFzIl0W9yXzWdtyD7rlasrPRcXL++p9yW61HF8nMrfGqkTBzUX5rDQ0bEXCce0Vu8o+MRwGesNAp9RGfG9dOgq5lyOEAKJ4ygylpvSlqZCUM2bOT74DpqutD521puiHoeULfMJIL5qeQapxdIWhKhtbdCPkjNQrZGgqauqztsmlLbLDvZmfEbjo8k2Tb8GAwQLJm6KSb6P9Fol2efP34trgVnMcrHKwvUER7NGux3yqE/8Y5hbP03M/O3fd1znJjWMiTAWG9/yMP3A1usISMesuIMkxXrxj0ulyrodbwiXT3iQ8pW8X2iwwIfRurrIrTlIq40hJxOLilagkper8+SYpj1+/kQFvYkhVrqYs/wC1bwb12cS2+czd41YkCF7nV/jHhr10JgJd4j9BfovhlxyJg035GZULvsLartXYKk1FIqLttQgZxq9Ru8GNRGjg/HUHBgJ3mKq0Q3qLR6ZaxnhwOUyhDcjkH39LAtNA2l7q/2Mqc5sPEts5M4E0ptc9R1rOhl7ATBm8kE9ZD0qjip4ut3i1/bl258qkpq2ysJibRw6GsswlO4ArOXOismhYSetGvGPVc="
  - secure: "Dhc+t4ynia9JJ3lTRrpfaHjxGFbZxUR6qUXlbgPFB9oekJ0ljQOi1I23X3Dl+NCLV+EtKuujCCMMPWBApysQX4ieGIZ6Mr9diO+GZIhxB9lwD954EbvRylnLxO7dryOysPp8zSjh3GarL8acQlX8ck+n9xo3Q/abuRS7n5KbtlKmg3wcbFmPr9ncKKGTYNPh4y72ega9cWPSANwaiH99D5R6O84WVyjzydfRPeFI6xNUZJd7HCSp9uhrjrhF26AKkS8YF/n3kE1aoLXyVsa/cV98QwkNOwEUVOSTpIEGVH3X/RDBImYpEDgFU8Gjw05Yk2ROm5rs1xTg9NGdXtGwect1NsNp8JNzp5PzfLF40voooe0dawm9aMWmFhSOLk0GjLDYMaeTFJbqpOUJ3OudVr1uHIGedI/+eFffm7fzpdHYR6c7ML7xuQa+muHSOaYA6AZEKFp01ho2eBH14bBEGiHSj+//+HYJU/aHplvxCOK1+AhDksamxpuBeRUAzzme1d3bpbkdCN7Q50XWJNZopecsRoRje7/ZyeE1pUtAkZsdsYUQ9BOUXrVctNY0wys2QCmdyBHzFhZCzMNA3Jsky3QvHXfig2pvWN1XYFqjpVmqtR/1MfJPjgnvmx8OV4yX8lT3CeLSvO6C7nWkJFOMut7FMHr7ar9YuK3WnL9rUUI="
  - secure: "MKds8WPbCGhX8C2+DC7fvWfBiKM32U1HbVDDSTWV6h6cgIvTa9wn+FBm1Rbz9pj7WPvkyW0UNhtStDw/ZDGIo3d6gqT6E3FdO6Mz75Hs9zrSrfMqCxVA9k4AaJSu2IZNiTuDFiEYmcQow1ULs1Ut9gp7skNs7QDlun9hKqKjgcGns2mywelIUjuRG1bcqUygr2L8xsj4fW4g1kDFNhWyxMComkqugJdGUGzw4HIXH5bUjZim+jO29XrJ+DltP5PL1yzXwIjGaLCG88Wl7DirD3ZIlbE+6D2jzEQaBwTVw/v9xvnr+BcLAp2PudZK3txpmdRnp8FrF1nBBWZGEAuCPa81XpDqYkhd7kooo/C5gIGOVr5jRrdPs6t9tjMYEAsZqAdyTKot0PZ6ORyBHdhJLJeHGG4ynI7tcohf49vdTVCbFaMO+Yg0ONSvOnHwFsdEuS1vPXLd/abSma1kTtiobH10TAQiZN2RNxws1kmpndopDI3w+HKhco4D3tiwgy277iamHXCLFvp+9r/szjnC4H1/oTAhgkJ/OBV6Jc9LLBCatbwinhpW1M1hsu9z2BsfVkFRY2j4+wU4WSDE39R/0ECIVDbeUzykVjLP86WL6PALQfP0F8AIgsTpKnlK91uTMNPxx5ikpm3dfwMIQIIj8maT2B1T0i1uSWDjloOY+So="
notifications:
  pushover:
    on_success: always
    on_failure: always
    api_key:
      secure: "aGCc23inkUSEf/5VEmndQlkF0yz49f30NaUuIQq8Ub0EDQHpKLti2b2YoTyt6qWLKKLOlsp8yfozBIkvr3RLODGoxtnFqaoOKKcstX2aoqkglcdzp2P3IUz8Qwfx7sCwMPIPprIrU93GKn0k2RQl5tvt7LZLfs44YkqMSogZk+ggxYoMYco51SqQNzjcpTbUtLnK/m/B9NsHktAvLQwwhOf5nawI5R5cRsM+YIayvFcsM8VCJX6bvBo89g6hDst5BNYisCjtHlpvcrZbVm5JdWoyT2z8pvWfqsy1p0Weqtt3+SPDFiJAA/0s5xq+6m3K2Z6ewkpiu6WElogLgbhfIS9dqDvlJUkI5qGKbPL/pfL4m+1BJ8UpfGpgw6Lajaq+Vt6XsXeQBqdUyCYHN/zTc2x596SaqLMIRjrQ2wbosDjt/iecHVg/m7goK6p5XsUMXmwgRL6pp67/huvJU8gVsE/FnQ/7l/EIr5rfGkR8iknuwONG+CJIZ4Idx8GfnK2qhqWE7N2QrPeUyv66jIMtRU97mkhGlQ4eE4NeIHzQ8z4wKS1k80ucaQWEIU0ejY4BEmfPFvcxu7VUTDrhRBcIPNhkUPO81gkcrNWz7ukOoDHNQ+uyb0dOWYU8a+2/8y68mhqMxu2LH5xd62sU38u4hdYYuibF6oxRUBAlkzqY0Y4="
    users:
      secure: "n8BdLWvA99T3+cKcx5S62tSTp4BpJ74FnIGFEAe4yM18puRUotAK7skvN/nS6km7ipwo2Kk+/NuTE4ZEn0UuHAyncOTMA4jUzhAE2JAGMfBjOGxQdHlv777iCKpqohnceD3d2FLo51/2WKjB3m30BGY6vX242SVxJa/W7meJZtm9rVdcR/KF2Zv8ZwQ2Epl7/yxJf8Lti3jP8yru9+K7hNi7+i+K8/ZNIEzrCmOZ2+F9dDUKcijVz95oI77dvizlU68KS70db1hi7iqVU2HcnHGFsx/ogLL7Ft0+LFbGRLRWZHqLqCyw9i6lwm/DxQM+rHFvvgvBuWLpiy53ZMMzvli63OLsNOKfmm/3Ovjij311QOGvgSjN6d3ExF4oiP86MYgy+rOvGDZl+S++kwF+3wLERBSXJXxYkXgcQveXe+OUKgCxOF4DhcA0/LsudCRxHc/h034TTsqGyT7llJmjux7go38ggHbSbLWU3cL4DElCKJIHiT4V3H6gpBi7OPJLo1RB95kBMzHgV1vMs8enaX6NxsS2dO56JPPCrl5thgrjGJ6C1tsLvegH2CbazI+as5vi8/zFdNy3ZIr39cjUH2i0SaO3l4P3BPemiS6UNjmtWZLJAjxV/t4uHRNm2Qyf8oh5zgqTpKxoirE/jfxzzk7ZRx5ZfshVmvx93GVuYYI="
  email:
    on_success: never
    on_failure: change
before_install:
- nvm install 9.5
- gem update --system
- gem install bundler
install:
- npm install -g firebase-tools
- npm install -g gulp-cli
- firebase use itsolver-499d1 --token "$FIREBASE_API_TOKEN"
# Unset stripe config before setting environment variables
# - echo "Configuring Stripe test keys""
- echo "Configuring Stripe live keys"
- firebase functions:config:unset stripe --token "$FIREBASE_API_TOKEN"
- firebase functions:config:set stripe.publishable_key="$STRIPE_PUBLISHABLE_KEY" --token "$FIREBASE_API_TOKEN"
- firebase functions:config:set stripe.secret_key="$STRIPE_SECRET_KEY" --token "$FIREBASE_API_TOKEN"
- firebase functions:config:set stripe.webhook_secret="$STRIPE_WEBHOOK_SECRET" --token "$FIREBASE_API_TOKEN"
- cd functions && npm install && cd ..
- npm install
- bundle install
script:
- cd functions && npm run build
- travis_retry gulp build --prod
after_success:
- firebase --non-interactive deploy --token "$FIREBASE_API_TOKEN"
- gulp submit
